-- USERS : 사용자의 기본정보  테이블
CREATE SEQUENCE USERS_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE;

CREATE TABLE USERS (
USER_ID           NUMBER PRIMARY KEY,
EMAIL             VARCHAR2(100) NOT NULL,
PASSWORD          VARCHAR2(255) NOT NULL,
NICKNAME          VARCHAR2(50)  NOT NULL,
BIRTHDATE DATE,
AGE NUMBER,
GENDER VARCHAR2(10),
HEIGHT            NUMBER,
CURRENT_WEIGHT    NUMBER,
MAIN_GOAL         NUMBER NOT NULL,
PROFILE_IMAGE_URL VARCHAR2(255),
CREATED_AT DATE DEFAULT SYSDATE,
STATUS            VARCHAR2(20) DEFAULT 'ACTIVE',
ROLE              VARCHAR2(20) DEFAULT 'USER',

CONSTRAINT UK_USERS_EMAIL UNIQUE (EMAIL)
);


-- MEAL_ENTRY : 사용자 한 끼 식사 기록 테이블
CREATE TABLE MEAL_ENTRY (
    ENTRY_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID         NUMBER           NOT NULL,
    MEAL_NAME       VARCHAR2(255)    NOT NULL,
    EAT_TIME        TIMESTAMP        NOT NULL,
    CALORIES_KCAL   NUMBER           DEFAULT 0 NOT NULL,
    PROTEIN_G       NUMBER           DEFAULT 0 NOT NULL,
    CARBS_G         NUMBER           DEFAULT 0 NOT NULL,
    FATS_G          NUMBER           DEFAULT 0 NOT NULL,
    SUGAR_G         NUMBER           DEFAULT 0 NOT NULL,
    FIBER_G         NUMBER           DEFAULT 0 NOT NULL,  
    CALCIUM_MG      NUMBER           DEFAULT 0 NOT NULL,
    SODIUM_MG       NUMBER           DEFAULT 0 NOT NULL,
    CREATED_AT      TIMESTAMP        DEFAULT SYSTIMESTAMP NOT NULL,

    CONSTRAINT FK_ME_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
);

-- 식품 및 영양 성분 테이블
CREATE TABLE FOOD_NUTRITION (
    FOOD_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    FOOD_NAME      VARCHAR2(100)   NOT NULL UNIQUE,
    CATEGORY       VARCHAR2(100)   NOT NULL,
    CALORIES_KCAL  NUMBER          DEFAULT 0,
    CARBS_G        NUMBER          DEFAULT 0,
    PROTEIN_G      NUMBER          DEFAULT 0,
    FAT_G          NUMBER          DEFAULT 0,
    SUGAR_G        NUMBER          DEFAULT 0,
    FIBER_G        NUMBER          DEFAULT 0,
    CALCIUM_MG     NUMBER          DEFAULT 0,
    SODIUM_MG      NUMBER          DEFAULT 0
);

-- USER_GOAL : 사용자 목표 영양 정보 테이블
CREATE TABLE USER_GOAL (
    GOAL_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID        NUMBER       NOT NULL,
    CALORIES_KCAL  NUMBER       NOT NULL,
    PROTEIN_G      NUMBER       NOT NULL,
    CARBS_G        NUMBER       NOT NULL,
    FATS_G         NUMBER       NOT NULL,

    CONSTRAINT FK_UG_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
);

-- HEALTH_SCORE_DAILY : 사용자 하루 건강 점수 테이블
CREATE TABLE HEALTH_SCORE_DAILY (
    SCORE_ID        NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID         NUMBER       NOT NULL,
    SCORE_DATE      DATE         NOT NULL,
    SCORE           NUMBER       NOT NULL,
    STATUS_MESSAGE  VARCHAR2(50),

    CONSTRAINT FK_HSD_USER FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID),
    CONSTRAINT UQ_HSD_USER_DATE UNIQUE (USER_ID, SCORE_DATE),
    CONSTRAINT CK_HSD_SCORE CHECK (SCORE BETWEEN 0 AND 100)
);

-- POSTS : 사용자 커뮤니티 게시글 테이블
CREATE TABLE POSTS (
    POST_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    CONTENT VARCHAR2(4000),
    HEALTH_SCORE NUMBER(3,0),
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_POSTS_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

-- COMMENTS : 게시글 댓글 테이블
CREATE TABLE COMMENTS (
    COMMENT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    CONTENT VARCHAR2(2000) NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_COMMENTS_POSTS FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE, 
    CONSTRAINT FK_COMMENTS_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE
);

-- LIKES : 게시물 좋아요 테이블
CREATE TABLE LIKES (
    LIKE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_LIKES_POSTS FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE, 
    CONSTRAINT FK_LIKES_USERS FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    CONSTRAINT UK_LIKES_POST_USER UNIQUE (POST_ID, USER_ID)
);

-- POST_IMAGES : 게시글 이미지 저장 테이블
CREATE TABLE POST_IMAGES (
    IMAGE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    POST_ID NUMBER NOT NULL,
    IMAGE_URL VARCHAR2(1000) NOT NULL,
    DISPLAY_ORDER NUMBER DEFAULT 1 NOT NULL,
    CONSTRAINT FK_POST_IMAGES FOREIGN KEY (POST_ID)
        REFERENCES POSTS(POST_ID) ON DELETE CASCADE
);

-- 설문지 테이블
CREATE TABLE USER_DIET_TYPE (
    USER_ID NUMBER PRIMARY KEY,
    PROTEIN_TYPE VARCHAR2(20),
    FAT_TYPE VARCHAR2(20),
    CARB_TYPE VARCHAR2(20),
    DIET_TYPE VARCHAR2(50),
    UPDATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_USER_DIET_TYPE_USERS
        FOREIGN KEY (USER_ID)
        REFERENCES USERS(USER_ID)
        ON DELETE CASCADE
);


--유저테이블 총 포인트 추가(기본값0)
ALTER TABLE USERS ADD TOTAL_POINTS NUMBER DEFAULT 0;

CREATE TABLE CHALLENGES (
    CHALLENGE_ID    NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    TITLE           VARCHAR2(255) NOT NULL,
    DESCRIPTION     VARCHAR2(255),
    IMAGE_URL       VARCHAR2(255),
    DIFFICULTY      VARCHAR2(100) NOT NULL,
    POINTS          NUMBER DEFAULT 0 NOT NULL,
    DURATION_DAYS   NUMBER,
    CHALLENGE_TYPE  VARCHAR2(100) DEFAULT '1' NOT NULL, -- 문자열이므로 '1'로 수정 권장
    TARGET_VALUE    NUMBER NOT NULL,
    METRIC_KEY      VARCHAR2(50) NOT NULL,
    TARGET_PERSONA  VARCHAR2(100),
    TARGET_GOAL     VARCHAR2(100)
);


-- ==================================================
-- SaveUs Final Data Set (Oracle Compatible)
-- 1. 한 줄씩 개별 INSERT 문으로 변경
-- 2. CHALLENGE_TYPE 문자열 적용 ('LIMIT', 'MINIMUM', 'CHECK')
-- ==================================================

-- [1] 메디컬 케어 (Medical Health)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('DASH 혈압 관리', '미국 심폐혈관연구소 추천! 혈압 관리를 위해 나트륨 2000mg 이하로 드세요.', '/images/ch/dash.jpg', 'Hard', 15, 1, 'LIMIT', 2000, 'sodium', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('혈당 스파이크 방지', '식곤증과 비만 예방! 단순 당류 섭취를 20g 이하로 제한하세요.', '/images/ch/sugar_cut.jpg', 'Hard', 15, 1, 'LIMIT', 20, 'sugar', 'HC_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('근감소증 예방 루틴', '나이 들수록 빠지는 근육 방어! 하루 단백질 60g 이상 꼭 챙기세요.', '/images/ch/sarco.jpg', 'Easy', 5, 1, 'MINIMUM', 60, 'protein', 'PRO_LOW', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('마이크로바이옴 케어', '면역력의 핵심 장 건강! 식이섬유 25g 이상 섭취하여 유익균을 늘리세요.', '/images/ch/gut.jpg', 'Medium', 10, 1, 'MINIMUM', 25, 'fiber', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('콜레스테롤 케어', '혈관 청소! 하루 지방 섭취 총량을 40g 이하로 줄이세요.', '/images/ch/chol.jpg', 'Medium', 10, 1, 'LIMIT', 40, 'fat', 'FAT_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('위장 휴식 (야식 금지)', '역류성 식도염 예방! 밤 9시 이후 섭취 칼로리 0kcal 유지하기.', '/images/ch/no_night.jpg', 'Medium', 10, 1, 'LIMIT', 0, 'calories_late_night', 'ALL', 'HEALTH');

-- [2] 뷰티 & 다이어트 (Beauty & Diet)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('아이돌 붓기 루틴', '촬영 전날 루틴! 붓기 삭제를 위해 나트륨 1500mg 이하로 제한합니다.', '/images/ch/idol_v.jpg', 'Hell', 25, 1, 'LIMIT', 1500, 'sodium', 'ALL', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('급찐급빠 3일 리셋', '주말 동안 찐 살 복구! 3일 안에 체중 -1kg 감량 인증하기.', '/images/ch/reset.jpg', 'Hard', 68, 3, 'CHECK', -1, 'weight_loss', 'ALL', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('숨겨진 복근 찾기', '체지방 걷어내기! 하루 섭취 열량을 1500kcal 이하로 맞추세요.', '/images/ch/abs.jpg', 'Hard', 15, 1, 'LIMIT', 1500, 'calories', 'ALL', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('D-Day 웨딩 케어', '인생샷을 위한 극단적 관리! 당류를 10g 미만으로 끊으세요.', '/images/ch/wedding.jpg', 'Hell', 25, 1, 'LIMIT', 10, 'sugar', 'HC_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('가벼운 아침 시작', '공복 효율 높이기! 아침 식사를 200kcal 이하로 가볍게 드세요.', '/images/ch/morning_light.jpg', 'Easy', 5, 1, 'LIMIT', 200, 'calories_breakfast', 'ALL', 'WEIGHT_LOSS');

-- [3] 피트니스 & 퍼포먼스 (Fitness)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('린매스업 식단', '근육 선명도 Up! 하루 단백질 100g 이상 충분히 섭취하세요.', '/images/ch/lean.jpg', 'Hard', 15, 1, 'MINIMUM', 100, 'protein', 'PRO_LOW', 'MUSCLE_GAIN');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('고강도 에너지 로딩', '하체 하는 날! 수행능력을 위해 탄수화물 200g 이상 드세요.', '/images/ch/loading.jpg', 'Medium', 10, 1, 'MINIMUM', 200, 'carbs', 'HC_LOW', 'MUSCLE_GAIN');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('3대 500을 향하여', '근성장을 위한 벌크업! 하루 단백질 120g 이상 때려 넣으세요.', '/images/ch/big_muscle.jpg', 'Hell', 25, 1, 'MINIMUM', 120, 'protein', 'PRO_LOW', 'MUSCLE_GAIN');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('벌크업 칼로리', '사이즈 키우기! 하루 총 열량 2500kcal 이상 섭취하세요.', '/images/ch/bulk_cal.jpg', 'Hard', 15, 1, 'MINIMUM', 2500, 'calories', 'HC_LOW', 'MUSCLE_GAIN');

-- [4] 탄수화물 집중 관리 (Carbs Control)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('저탄수화물 입문', '가장 쉬운 다이어트! 하루 탄수화물 250g 이하 유지.', '/images/ch/c1.jpg', 'Easy', 5, 1, 'LIMIT', 250, 'carbs', 'HC_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('밥 한 공기 덜기', '식습관 교정! 하루 탄수화물 200g 목표로 줄여보세요.', '/images/ch/c3.jpg', 'Medium', 10, 1, 'LIMIT', 200, 'carbs', 'HC_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('7일 탄수 제한', '일주일 집중 관리! 매일 탄수화물 150g 이하를 유지하세요.', '/images/ch/c5.jpg', 'Medium', 70, 7, 'LIMIT', 150, 'carbs', 'HC_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('탄수화물 디톡스', '몸을 가볍게! 하루 탄수화물 100g 이하로 제한하세요.', '/images/ch/c4.jpg', 'Hard', 15, 1, 'LIMIT', 100, 'carbs', 'HC_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('키토제닉(저탄고지)', '지방 대사 켜기! 탄수화물 50g 미만으로 극단적 제한.', '/images/ch/keto.jpg', 'Hard', 15, 1, 'LIMIT', 50, 'carbs', 'HC_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('건강한 탄수화물', '너무 적게 먹어도 문제! 최소 150g 이상은 챙겨 드세요.', '/images/ch/hc_up1.jpg', 'Easy', 5, 1, 'MINIMUM', 150, 'carbs', 'HC_LOW', 'HEALTH');

-- [5] 단백질 집중 관리 (Protein Control)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('단백질 베이직', '건강 유지의 기본! 하루 단백질 50g은 꼭 채우세요.', '/images/ch/p_basic.jpg', 'Easy', 5, 1, 'MINIMUM', 50, 'protein', 'PRO_LOW', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('아침 단백질 루틴', '하루 활력! 아침 식사(05~11시)에 단백질 20g을 포함하세요.', '/images/ch/p4.jpg', 'Medium', 10, 1, 'MINIMUM', 20, 'protein_breakfast', 'PRO_LOW', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('3일 연속 단백질', '꾸준함이 생명! 3일 동안 매일 단백질 80g 이상 드세요.', '/images/ch/p5.jpg', 'Medium', 30, 3, 'MINIMUM', 80, 'protein', 'PRO_LOW', 'WEIGHT_GAIN');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('단백질 밸런스', '통풍/신장 주의! 단백질 섭취를 150g 이하로 조절하세요.', '/images/ch/p_cut.jpg', 'Medium', 10, 1, 'LIMIT', 150, 'protein', 'PRO_HIGH', 'HEALTH');

-- [6] 지방 집중 관리 (Fat Control)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('저지방 식단', '기름기 쏙 빼기! 하루 지방 50g 이하로 유지하세요.', '/images/ch/f_basic.jpg', 'Medium', 10, 1, 'LIMIT', 50, 'fat', 'FAT_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('지방 방어선', '최소한의 방어! 지방 섭취가 60g을 넘지 않도록 주의하세요.', '/images/ch/f2.jpg', 'Easy', 5, 1, 'LIMIT', 60, 'fat', 'FAT_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('지방 커팅', '극한의 커팅! 하루 지방 20g 이하로 제한하세요.', '/images/ch/f4.jpg', 'Hell', 25, 1, 'LIMIT', 20, 'fat', 'FAT_HIGH', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('지방 섭취 충족', '호르몬 불균형 방지! 지방을 최소 40g 이상은 드셔야 합니다.', '/images/ch/f_up.jpg', 'Easy', 5, 1, 'MINIMUM', 40, 'fat', 'FAT_LOW', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('고지방(키토) 식단', '키토제닉 에너지원! 지방을 100g 이상 충분히 섭취하세요.', '/images/ch/f3.jpg', 'Hard', 15, 1, 'MINIMUM', 100, 'fat', 'FAT_LOW', 'WEIGHT_LOSS');

-- [7] 당류 & 나트륨 (Sugar & Sodium)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('가공식품 줄이기', '액상과당 주의! 하루 당류 30g 이하로 줄이세요.', '/images/ch/s2.jpg', 'Medium', 10, 1, 'LIMIT', 30, 'sugar', 'HC_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('달콤함 덜어내기', '디저트 줄이기! 하루 당류 50g 이하를 목표로 하세요.', '/images/ch/s3.jpg', 'Easy', 5, 1, 'LIMIT', 50, 'sugar', 'HC_HIGH', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('국물 참기', '라면 국물 금지! 나트륨 3000mg 이하로 유지하세요.', '/images/ch/n3.jpg', 'Easy', 5, 1, 'LIMIT', 3000, 'sodium', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('저염식 베이직', 'WHO 권장량 준수! 나트륨 2500mg 이하로 조절하세요.', '/images/ch/n_basic.jpg', 'Medium', 10, 1, 'LIMIT', 2500, 'sodium', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('2주 나트륨 클린', '입맛 성형 프로젝트! 14일간 매일 나트륨 2500mg 이하 유지.', '/images/ch/n4.jpg', 'Hard', 210, 14, 'LIMIT', 2500, 'sodium', 'ALL', 'HEALTH');

-- [8] 칼로리 & 라이프스타일 (Calories & Life)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('칼로리 밸런스', '성인 권장량! 하루 2000kcal(±10%) 내외로 섭취하세요.', '/images/ch/cal_bal.jpg', 'Medium', 10, 1, 'LIMIT', 2000, 'calories', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('가벼운 저녁', '속 편한 밤! 저녁 식사를 500kcal 이하로 드세요.', '/images/ch/cal4.jpg', 'Easy', 5, 1, 'LIMIT', 500, 'calories_dinner', 'ALL', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('헤비한 점심', '활동량 많은 오후! 점심에 800kcal 이상 든든하게 드세요.', '/images/ch/cal6.jpg', 'Easy', 5, 1, 'MINIMUM', 800, 'calories_lunch', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('작심삼일 타파', '습관 형성의 시작! 3일 연속 목표 칼로리(2000kcal) 달성.', '/images/ch/habit_3.jpg', 'Medium', 30, 3, 'LIMIT', 2000, 'calories', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('기록의 시작', '일단 기록부터! 영양성분 기록 1회 완료 (칼로리 1 이상).', '/images/ch/cb4.jpg', 'Easy', 5, 1, 'MINIMUM', 1, 'calories', 'ALL', 'HEALTH');

-- [9] 체중 & 기타 (Weight)
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('유지어터 1주', '요요 방지! 일주일간 체중 변동폭을 0.5kg 이내로 유지.', '/images/ch/maintain.jpg', 'Medium', 105, 7, 'CHECK', 0.5, 'weight_maintain', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('목표 체중 달성', '나와의 약속! 설정한 목표 체중(Goal Weight)에 도달하세요.', '/images/ch/w3.jpg', 'Hell', 50, 1, 'CHECK', 0, 'weight_goal', 'ALL', 'WEIGHT_LOSS');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('채소 습관', '변비 탈출! 하루 식이섬유 20g 이상 섭취하세요.', '/images/ch/fiber_basic.jpg', 'Easy', 5, 1, 'MINIMUM', 20, 'fiber', 'ALL', 'HEALTH');
INSERT INTO CHALLENGES (TITLE, DESCRIPTION, IMAGE_URL, DIFFICULTY, POINTS, DURATION_DAYS, CHALLENGE_TYPE, TARGET_VALUE, METRIC_KEY, TARGET_PERSONA, TARGET_GOAL) VALUES ('한 달 채소 습관', '30일 장기 프로젝트! 매일 식이섬유 20g 이상 섭취.', '/images/ch/cb5.jpg', 'Hell', 750, 30, 'MINIMUM', 20, 'fiber', 'ALL', 'HEALTH');

COMMIT;


------------------------------

CREATE TABLE USER_CHALLENGES (
    USER_CHALLENGE_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID           NUMBER NOT NULL, 
    CHALLENGE_ID      NUMBER NOT NULL,
    STATUS            VARCHAR2(30) DEFAULT 'ONGOING' NOT NULL, -- ONGOING, COMPLETED, FAILED
    PROGRESS_PERCENT  NUMBER(3) DEFAULT 0 NOT NULL,
    START_DATE        DATE DEFAULT SYSDATE NOT NULL,
    START_VALUE       NUMBER,              -- 체중 감량 등 시작값 (NULL 허용)
    CURRENT_COUNT     NUMBER DEFAULT 0 NOT NULL, -- 성공 횟수 (스케줄러 카운팅용)
    LAST_CHECKED_AT   DATE,                -- 중복 검사 방지용 (NULL 허용)
    CONSTRAINT FK_UC_USER FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    CONSTRAINT FK_UC_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES CHALLENGES(CHALLENGE_ID) ON DELETE CASCADE
);

---------------------------------------------

-- 1. TAGS 테이블 생성 (태그 정보)
CREATE TABLE TAGS (
    TAG_ID   NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY, -- PK, 자동 증가
    TAG_NAME VARCHAR2(100) NOT NULL,                          -- 태그 이름
    CONSTRAINT UQ_TAG_NAME UNIQUE (TAG_NAME)                  -- 태그 이름 중복 방지 (UQ)
);

-- 2. CHALLENGE_TAGS 테이블 생성 (챌린지-태그 연결 테이블)
CREATE TABLE CHALLENGE_TAGS (
    CHALLENGE_ID NUMBER NOT NULL,
    TAG_ID       NUMBER NOT NULL,
    -- 복합 기본키 (Composite Primary Key) 설정
    CONSTRAINT PK_CHALLENGE_TAGS PRIMARY KEY (CHALLENGE_ID, TAG_ID),
    -- 외래키 (Foreign Key) 설정
    -- 챌린지가 삭제되면 연결된 태그 정보도 삭제 (ON DELETE CASCADE)
    CONSTRAINT FK_CT_CHALLENGE FOREIGN KEY (CHALLENGE_ID) 
        REFERENCES CHALLENGES(CHALLENGE_ID) ON DELETE CASCADE,
    -- 태그가 삭제되면 연결된 정보도 삭제
    CONSTRAINT FK_CT_TAG FOREIGN KEY (TAG_ID) 
        REFERENCES TAGS(TAG_ID) ON DELETE CASCADE
);

--유저 뱃지 테이블
CREATE TABLE USER_BADGES (
    BADGE_ID      NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    USER_ID       NUMBER NOT NULL,
    CHALLENGE_ID  NUMBER NOT NULL,
    ACQUIRED_AT   DATE DEFAULT SYSDATE,
    -- [중복 방지] 한 유저는 같은 챌린지 뱃지를 중복 보유할 수 없음
    CONSTRAINT UK_USER_CHALLENGE_BADGE UNIQUE (USER_ID, CHALLENGE_ID),
    CONSTRAINT FK_UB_USER FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE,
    CONSTRAINT FK_UB_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES CHALLENGES(CHALLENGE_ID) ON DELETE CASCADE
);


-- 성공 횟수 누적 저장 (기본값 0)
ALTER TABLE USER_CHALLENGES ADD SUCCESS_COUNT NUMBER DEFAULT 0 NOT NULL;
